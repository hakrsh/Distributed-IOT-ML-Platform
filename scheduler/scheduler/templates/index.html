<!DOCTYPE html>
<html>

<head>
    <title>Schedule App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="./js/script.js"></script>
</head>

<body>
    <h1 style="margin: 50px;">Scheduler UI</h1>
    <form action="/schedule" method="post" style="margin: 50px;">
        <div class="form-group">
            <label for="app_name">Application name</label>
            <select class="form-control form-control-lg" id="app_name" name="app_name">
                {% for app in app_list %}
                {% for key, value in app.items() %}
                <option value="{{key}}">{{value}}</option>"
                {% endfor %}
                {% endfor %}
            </select>
        </div>
        <div class="form-group" id="sensors_list">
            <label for="sensor_loc">Sensor Type and Location</label>
            <select class="form-control form-control-lg" id="my_sensors" name="my_sensors" multiple>
                {% for loc in sensors %}
                <option value="{{loc}}">{{loc}}</option>"
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="datetime">Date and Time</label>
            <input type="datetime-local" id="datetime" name="datetime">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</body>

<script>
    
    document.getElementById('app_name').onchange = function () {
        var app_id = this.value;

        console.log(app_id)
        $.ajax({
            type: 'POST',
            data: JSON.stringify({
                'app_id': app_id,
            }),
            contentType: 'application/json; charset=utf-8',
            url: "{{ url_for('get_app_contract') }}",
            success: function (data) {

                
                // <label for="sensor_loc">Sensor Type and Location</label>
                //     <select class="form-control form-control-lg" id="my_sensors" name="my_sensors" multiple>
                //         {% for loc in sensors %}
                //         <option value= "{{loc}}" >{{loc}}</option>"
                //         {% endfor %}
                //     </select>

                console.log(data)
                $("#sensors_list").empty();

                data = JSON.parse(data)
                for (var i = 0; i < data.length; i++) {

                    // console.log(data[i])
                    var sensor_type = data[i].sensor_type
                    var count = data[i].count
                    var sensors_list = data[i].sensors_list

                    // console.log(sensor_type,count,sensors_list);

                    $("#sensors_list").append(' \
                    <label for="sensor_loc">Sensor Type '+sensor_type+'</label"\
                        <select class="form-control form-control-lg" id='+i+'_sensor name="my_sensors" multiple>');

                            var id_s = i+"_sensor"
                            for (var i = 0; i < sensors_list; i++) {
                            $(id_s).append(
                            "<option value=" + sensor_type+"-"+sensors_list[1] + 'id=+'+sensors_list[0]+'">' + sensor_type+"-"+sensors_list[1] + '</option>');
                            }
                    $("#sensors_list").append("</select>");
                }
            }
        });
    }
</script>

</html>