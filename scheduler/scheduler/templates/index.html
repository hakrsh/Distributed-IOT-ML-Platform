<!DOCTYPE html>
<html>

<head>
    <title>Schedule App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <h1 style="margin: 50px;">Scheduler UI</h1>
    <form action="/schedule" method="post" style="margin: 50px;">
        <div class="form-group">
            <label for="app_name">Application name</label>
            <select class="form-control form-control-lg" id="app_name" name="app_name">
                {% for app in app_list %}
                {% for key, value in app.items() %}
                <option value="{{key}}">{{value}}</option>"
                {% endfor %}
                {% endfor %}
            </select>
        </div>
        <div class="form-group" id="sensors_list">
            <label for="sensor_loc">Sensor Type and Location</label>
            <select class="form-control form-control-lg" id="my_sensors" name="my_sensors" multiple>
                {% for loc in sensors %}
                <option value="{{loc}}">{{loc}}</option>"
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="datetime">Start Date and Time</label>
            <input type="datetime-local" id="starttime" name="starttime">
        </div>
        <div class="form-group">
            <label for="datetime">End Date and Time</label>
            <input type="datetime-local" id="endtime" name="endtime">
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
    </form>
</body>
<script>

    document.getElementById('app_name').onchange = function () {
        var app_id = this.value;

        console.log(app_id)
        $.ajax({
            type: 'POST',
            data: JSON.stringify({
                'app_id': app_id,
            }),
            contentType: 'application/json; charset=utf-8',
            url: "{{ url_for('get_app_contract') }}",
            success: function (data) {


                // <label for="sensor_loc">Sensor Type and Location</label>
                //     <select class="form-control form-control-lg" id="my_sensors" name="my_sensors" multiple>
                //         {% for loc in sensors %}
                //         <option value= "{{loc}}" >{{loc}}</option>"
                //         {% endfor %}
                //     </select>

                // console.log(data)
                $("#sensors_list").empty();

                data = JSON.parse(data)
                for (var i = 0; i < data.length; i++) {

                
                    var sensor_type = data[i].sensor_type
                    var count = data[i].count
                    var sensor_list = data[i].sensors_list

                    console.log(sensor_list);
                    $('#sensors_list').append('<label for="sensor_loc">Sensor Type: '+ sensor_type + '</label>\
                    <select class="form-control form-control-lg" id='+ i + '_sensor name="my_sensors" multiple>');
                    var id_s = i + "_sensor"
                    for (var j = 0; j < sensor_list.length; j++) {
                        $('#'+id_s).append(
                            "<option value=" + sensor_type + "-" + sensor_list[j][1] + 'id=+' + sensor_list[j][0] + '">' + sensor_type + "-" + sensor_list[j][1] + '</option>');
                    }
                }
            }
        });
    }
</script>

</html>